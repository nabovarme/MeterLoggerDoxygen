<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MeterLogger: README.md Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MeterLogger
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">README.md</div>  </div>
</div><!--header-->
<div class="contents">
<a href="kamstrup-wifi_2_r_e_a_d_m_e_8md.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;To build and flash for KMP type meter (Multical 601):  </div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;```  </div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;KEY=ef500c9268cf749016d26d6cbfaaf7bf make clean all flashall  </div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;```  </div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;  </div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;To build and flash for en61107, sub type Multical 66 C:  </div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;```  </div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;EN61107=1 KEY=ef500c9268cf749016d26d6cbfaaf7bf make clean all flashall  </div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;```  </div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;  </div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;To build and flash for en61107, sub type Multical 66 B:  </div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;```  </div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;MC_66B=1 KEY=ef500c9268cf749016d26d6cbfaaf7bf make clean all flashall  </div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;```  </div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;  </div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;To build and flash for impulse based electricity meter:  </div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;```  </div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;IMPULSE=1 KEY=ef500c9268cf749016d26d6cbfaaf7bf make clean all flashall  </div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;```  </div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;  </div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;To configure wireless network:  </div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;```  </div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;SERIAL=9999999 KEY=ef500c9268cf749016d26d6cbfaaf7bf make wifisetup  </div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;```  </div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;  </div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;**BUILD OPTIONS**  </div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;DEBUG=1  </div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;enable serial debugging  </div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;  </div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;DEBUG_NO_METER=1  </div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;dont wait for meter to answer  </div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;  </div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;DEBUG_SHORT_WEB_CONFIG_TIME=1  </div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;dont wait for web config  </div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;  </div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;IMPULSE=1  </div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;meter type is impulse based (100 mS)  </div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;  </div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;EN61107=0  </div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;meter type is KMP (Multical 601)  </div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;  </div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;EN61107=1  </div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;meter type is en61107, sub type Multical 66 C  </div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  </div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;MC_66B=1  </div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;meter type is en61107, sub type Multical 66 B  </div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;  </div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;THERMO_NO=0  </div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;thermo actuator is normal closed  </div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  </div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;THERMO_NO=1  </div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;thermo actuator is normal open  </div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  </div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;LED_ON_AC=1  </div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;use led to indicate ac state  </div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;SERIAL=9999999  </div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;serial number for meter used for device&#39;s SSID: IMPULSE meters EL_9999999 and other Kamstrup meters KAM_9999999. Used in make wifisetup target and if DEBUG_NO_METER=1 </div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;KEY=ef500c9268cf749016d26d6cbfaaf7bf</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;master key for crypto, 16 bytes</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;Fist 8 bytes hex encoded (ef500c9268cf7490) is wifi setup password. Master key is sha256 hashed to 32 bit and first first 16 bytes is aes key and last 16 bytes is hmac sha256 key.</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;Crypto is applies on mqtt packages like: first 32 bytes of mqtt_message contains hmac sha256, next 16 bytes contains IV last part is aes encrypted data</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;AP=1</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;enable wireless extender; wireless AP</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;enables open source lwip and uses more memory so mqtt buffer is smaller when this option is set. </div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;**MQTT format for messages sent _to_ meter**  </div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;| Topic                                                  | Message                                                            |</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;| :----------------------------------------------------- | :----------------------------------------------------------------- |</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;| /config/v2/9999999/[unix time]/ping                    |                                                                    |</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;| /config/v2/9999999/[unix time]/open                    | [unix time]                                                        |</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;| /config/v2/9999999/[unix time]/open_until              | [kWh when meter should close]                                      |</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;| /config/v2/9999999/[unix time]/open_until_delta        | [[kWh when meter should close as delta]                            |</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;| /config/v2/9999999/[unix time]/close                   | [unix time]                                                        |</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;| /config/v2/9999999/[unix time]/status                  |                                                                    |</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;| /config/v2/9999999/[unix time]/set_cron                | minute=30&amp;hour=*&amp;day_of_month=*&amp;month=*&amp;day_of_week=*&amp;command=open |</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;| /config/v2/9999999/[unix time]/cron                    |                                                                    |</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;| /config/v2/9999999/[unix time]/clear_cron              | [unix time]                                                        |</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;| /config/v2/9999999/[unix time]/ping                    |                                                                    |</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;| /config/v2/9999999/[unix time]/version                 |                                                                    |</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;| /config/v2/9999999/[unix time]/uptime                  |                                                                    |</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;| /config/v2/9999999/[unix time]/rssi                    |                                                                    |</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;| /config/v2/9999999/[unix time]/ssid                    |                                                                    |</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;| /config/v2/9999999/[unix time]/scan                    |                                                                    |</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;| /config/v2/9999999/[unix time]/set_ssid                | [ssid]                                                             |</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;| /config/v2/9999999/[unix time]/set_pwd                 | [pwd]                                                              |</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;| /config/v2/9999999/[unix time]/wifi_status             |                                                                    |</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;| /config/v2/9999999/[unix time]/start_ap                | [start ap + save to flash if changed]                              |</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;| /config/v2/9999999/[unix time]/stop_ap                 | [stop ap + save to flash if changed]                               |</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;| /config/v2/9999999/[unix time]/ap_status               |                                                                    |</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;| /config/v2/9999999/[unix time]/reconnect               |                                                                    |</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;| /config/v2/9999999/[unix time]/save (only pulse meter) |                                                                    |</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;| /config/v2/9999999/[unix time]/mem                     |                                                                    |</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;| /config/v2/9999999/[unix time]/reset_reason            |                                                                    |</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;  </div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;**MQTT format for messages sent _from_ meter**  </div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;| Topic                                           | Message                                                                                              |</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;| :---------------------------------------------- | :--------------------------------------------------------------------------------------------------- |</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;| /sample/v2/9999999/[unix time]                  | heap=20000&amp;t1=25.00 C&amp;t2=15.00 C&amp;tdif=10.00 K&amp;flow1=0 l/h&amp;effect1=0.0 kW&amp;hr=0 h&amp;v1=0.00 m3&amp;e1=0 kWh&amp; |</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;| /cron/v2/9999999/[unix time]                    | 12                                                                                                   |</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;| /ping/v2/9999999/[unix time]                    |                                                                                                      |</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;| /version/v2/9999999/[unix time]                 | [sdk version]-[git version]                                                                          |</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;| /status/v2/9999999/[unix time]                  | [open|close]                                                                                         |</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;| /open_until/v2/9999999/[unix time]              | [kWh when meter should close]                                                                        |</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;| /open_until_delta/v2/9999999/[unix time]        | [kWh when meter should close]                                                                        |</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;| /uptime/v2/9999999/[unix time]                  | [uptime in seconds]                                                                                  |</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;| /rssi/v2/9999999/[unix time]                    | [rssi of the wifi it is connected to (in dBm, 31 if fail)]                                           |</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;| /ssid/v2/9999999/[unix time]                    | [ssid of the wifi it is connected to]                                                                |</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;| /scan_result/v2/9999999/[unix time]             | ssid=Loppen Public&amp;rssi=-51&amp;channel=11                                                               |</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;| /wifi_status/v2/9999999/[unix time]             | [connected or disconnected]                                                                          |</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;| /ap_status/v2/9999999/[unix time]               | [started or stopped]                                                                                 |</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;| /save/v2/9999999/[unix time] (only pulse meter) | saved                                                                                                |</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;| /mem/v2/9999999/[unix time]                     | heap=9672&amp;                                                                                           |</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;| /reset_reason/v2/9999999/[unix time]            |                                                                                                      |</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;</div></div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
